name: Previous Mobile Tag
description: Get the previous mobile tag
runs:
  using: 'composite'
  steps:
    - name: Fetch git history
      shell: bash
      run: git fetch --prune --unshallow --tags

    - name: Get previous tag
      id: previousTag
      shell: bash
      run: |
        current_tag=${{ github.ref_name }}
        echo $current_tag | grep -o "v[0-9]*\.[0-9]*\.[0-9]*"
        current_version=$(echo $current_tag | grep -o "v[0-9]*\.[0-9]*\.[0-9]*")
        git tag --sort=v:refname | grep -E "^mobile(-test)?-v[0-9]*\.[0-9]*\.[0-9]*(-beta|-alpha)?\.*" | grep -v "$current_version" | head -n 1
        previous_tag=$(git tag --sort=v:refname | grep -E "^mobile(-test)?-v[0-9]*\.[0-9]*\.[0-9]*(-beta|-alpha)?\.*" | grep -v "$current_version" | head -n 1)
        echo "tag=$previous_tag" >> "$GITHUB_OUTPUT"
